<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Food Recommender — EDA (2025)</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020; --panel:#0e1426; --card:#0b1220; --line:#1c2541; --ink:#e8eefb; --muted:#a9b3c6; --accent:#76a7ff; --accent2:#8ef; --good:#22d3a8; --bad:#ff7171;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 10% -10%, #12203a 0%, var(--bg) 45%);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{max-width:1200px;margin:0 auto;padding:28px 18px 10px}
    h1{margin:0;font-size:28px;letter-spacing:0.2px}
    header p{margin:6px 0 0;color:var(--muted)}
    .wrap{max-width:1200px;margin:0 auto;padding:0 18px 60px}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:16px 0}
    .pill{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);border:1px solid var(--line);border-radius:999px;padding:8px 12px;color:#d3ddf5}
    input[type="number"],input[type="text"]{background:#0c1530;border:1px solid var(--line);color:#e8eefb;border-radius:8px;padding:8px 10px;min-width:80px}
    button{background:linear-gradient(135deg,#5fa8ff,#7cd3ff);color:#07234a;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid var(--line);color:#cfe3ff}
    .grid{display:grid;gap:14px}
    .g2{grid-template-columns:1fr 1fr}
    .g3{grid-template-columns:1fr 1fr 1fr}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));border:1px solid var(--line);border-radius:16px;padding:14px}
    .cards{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
    .stat{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px}
    .stat .h{font-size:12px;color:var(--muted)}
    .stat .v{font-size:20px;font-weight:800;margin-top:6px}
    nav{display:flex;gap:8px;margin:10px 0 18px}
    .tab{background:#0c1530;border:1px solid var(--line);color:#d4e2ff;border-radius:10px;padding:8px 12px;cursor:pointer}
    .tab.active{background:#121a36;color:#fff;border-color:#39507a}
    .tabpane{display:none}
    .tabpane.active{display:block}
    .muted{color:var(--muted)}
    .good{color:var(--good)} .bad{color:var(--bad)}
    .note{font-size:12px;color:var(--muted);margin-top:6px}
    .kpi{display:flex;gap:10px;flex-wrap:wrap}
    .kpi .chip{background:#0c1530;border:1px solid var(--line);border-radius:999px;padding:6px 10px}
    .row{display:flex;gap:10px;align-items:center}
    .right{margin-left:auto}
    .footer{margin-top:16px;color:var(--muted);font-size:12px}
    .svgwrap{background:#0c1530;border:1px solid var(--line);border-radius:12px;height:520px;position:relative;overflow:hidden}
    .legend{font-size:12px;color:var(--muted)}
    .hl{color:#fff}
    a{color:var(--accent2);text-decoration:none}
    @media (max-width:1100px){ .g2,.g3{grid-template-columns:1fr} .cards{grid-template-columns:repeat(2,1fr)} }
  </style>

  <!-- libs (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
</head>
<body>
  <header>
    <h1>Food Recommender — EDA (business-first, 2025)</h1>
    <p>Reads <code>RAW_recipes.csv</code> or <code>PP_recipes.csv</code> + <code>interactions_train.csv</code> from this repo. No server, no build — just GitHub Pages.</p>
    <div class="toolbar">
      <button id="btnLoad">Load data</button>
      <span id="status" class="muted">Status: —</span>
      <span class="pill">Top-K tags <input id="topK" type="number" value="200" min="20" max="3000"></span>
      <button id="btnRedraw" class="ghost">Redraw</button>
      <span class="pill">Tag network edges ≥ <input id="edgeMin" type="number" value="40" min="2" max="500"></span>
      <span class="pill">Nodes ≤ <input id="nodeMax" type="number" value="60" min="20" max="200"></span>
      <span class="pill">Time group <input id="timeGroup" type="text" value="month" title="hour|day|week|month"></span>
    </div>
    <div class="kpi" id="fileLine">—</div>
  </header>

  <div class="wrap">
    <nav id="tabs">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="users">Users</button>
      <button class="tab" data-tab="items">Items</button>
      <button class="tab" data-tab="tags">Tags</button>
      <button class="tab" data-tab="time">Time</button>
      <button class="tab" data-tab="cold">Long-tail & Cold-start</button>
    </nav>

    <!-- OVERVIEW -->
    <section id="overview" class="tabpane active">
      <div class="cards" id="cards"></div>
      <div class="grid g2" style="margin-top:12px">
        <div class="card">
          <div class="row">
            <h3 style="margin:0">Interactions over time</h3>
            <span class="right muted" id="tsNote">—</span>
          </div>
          <div id="tsSeries" style="height:320px"></div>
        </div>
        <div class="card">
          <h3 style="margin:0">Day-of-week × hour heatmap</h3>
          <div id="dowHeat" style="height:320px"></div>
          <div class="note">If hours are missing in your CSV dates, this collapses to the date level.</div>
        </div>
      </div>
    </section>

    <!-- USERS -->
    <section id="users" class="tabpane">
      <div class="grid g2">
        <div class="card">
          <h3 style="margin:0">User activity (ratings per user)</h3>
          <div id="userHist" style="height:320px"></div>
        </div>
        <div class="card">
          <h3 style="margin:0">User avg rating vs. activity</h3>
          <div id="userScatter" style="height:320px"></div>
        </div>
      </div>
    </section>

    <!-- ITEMS -->
    <section id="items" class="tabpane">
      <div class="grid g2">
        <div class="card">
          <h3 style="margin:0">Item popularity (interactions per item)</h3>
          <div id="itemHist" style="height:320px"></div>
        </div>
        <div class="card">
          <h3 style="margin:0">Item avg rating vs. popularity</h3>
          <div id="itemScatter" style="height:320px"></div>
        </div>
      </div>

      <div class="grid g2">
        <div class="card">
          <h3 style="margin:0">Recipe time (minutes)</h3>
          <div id="minutesHist" style="height:320px"></div>
        </div>
        <div class="card">
          <h3 style="margin:0">Ingredients count</h3>
          <div id="ingCountHist" style="height:320px"></div>
        </div>
      </div>
    </section>

    <!-- TAGS -->
    <section id="tags" class="tabpane">
      <div class="grid g2">
        <div class="card">
          <h3 style="margin:0">Top 30 tags</h3>
          <div id="topTags" style="height:360px"></div>
        </div>
        <div class="card">
          <div class="row">
            <h3 style="margin:0">Tag co-occurrence graph</h3>
            <span class="right legend">drag nodes · scroll to zoom</span>
          </div>
          <div class="svgwrap"><svg id="tagGraph" width="100%" height="100%"></svg></div>
          <div class="note">Edges show how often tags appear together on the same recipe. Controlled by “edges ≥” and “nodes ≤”.</div>
        </div>
      </div>
    </section>

    <!-- TIME -->
    <section id="time" class="tabpane">
      <div class="grid g2">
        <div class="card">
          <h3 style="margin:0">Ratings histogram</h3>
          <div id="ratingHist" style="height:320px"></div>
        </div>
        <div class="card">
          <h3 style="margin:0">Interactions by calendar date</h3>
          <div id="calendar" style="height:320px"></div>
          <div class="note">Shows distribution over the calendar (by month/week, depending on your data).</div>
        </div>
      </div>
    </section>

    <!-- LONG-TAIL -->
    <section id="cold" class="tabpane">
      <div class="grid g2">
        <div class="card">
          <h3 style="margin:0">Lorenz curve (popularity long-tail)</h3>
          <div id="lorenz" style="height:360px"></div>
          <div class="note" id="giniLine">Gini ≈ —</div>
        </div>
        <div class="card">
          <h3 style="margin:0">Cold-start & Pareto</h3>
          <div id="pareto" style="height:360px"></div>
          <div class="note" id="paretoNote">—</div>
        </div>
      </div>
      <div class="footer">Tip: Place CSVs in repo root or in <code>/data/</code>. The loader tries both.</div>
    </section>
  </div>

  <script src="eda.js"></script>
</body>
</html>
